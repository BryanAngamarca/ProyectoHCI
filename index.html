<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;font-family:Arial;}
#video{position:absolute;width:100%;height:100%;object-fit:cover;}
#canvas{position:absolute;top:0;left:0;}

.ui{
 position:absolute;
 background:rgba(0,80,150,0.75);
 color:white;
 padding:10px 14px;
 border-radius:12px;
 z-index:3;
}

#msg{top:10px;left:50%;transform:translateX(-50%);}
#score{bottom:10px;left:10px;}
#timer{bottom:10px;right:10px;}
#level{top:10px;left:10px;}

#info{
 top:70px;left:10px;
 max-width:220px;
 background:rgba(0,0,0,0.6);
 font-size:14px;
}
</style>
</head>

<body>

<div id="msg" class="ui"></div>
<div id="score" class="ui">‚≠ê 0</div>
<div id="timer" class="ui">‚è±Ô∏è 60</div>
<div id="level" class="ui">Nivel 1</div>

<div id="info" class="ui">
üìò Aprende:<br>
Resistencia ‚Üí protege LED<br>
Interruptor ‚Üí abre/cierra paso<br>
Paralelo ‚Üí varios LEDs
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<audio id="ok" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="bad" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

<script>
const v=video, c=canvas, ctx=c.getContext("2d");
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(s=>v.srcObject=s);

function resize(){c.width=innerWidth;c.height=innerHeight;}
resize(); onresize=resize;

let score=0,time=60,level=0,step=0;
const scoreTxt=scoreEl=document.getElementById("score");
const msg=document.getElementById("msg");
const lvlTxt=document.getElementById("level");

const ok= document.getElementById("ok");
const bad=document.getElementById("bad");

const levels=[
 // NIVEL 1
 {
  name:"Nivel 1",
  steps:["Energ√≠a","Resistencia","LED"],
  points:[
   {x:90,y:300},
   {x:180,y:300},
   {x:270,y:300}
  ]
 },

 // NIVEL 2
 {
  name:"Nivel 2",
  steps:["Energ√≠a","Interruptor","Resistencia","LED"],
  points:[
   {x:60,y:300},
   {x:140,y:300},
   {x:220,y:300},
   {x:300,y:300}
  ]
 },

 // NIVEL 3
 {
  name:"Nivel 3",
  steps:["Energ√≠a","Resistencia","LED1","LED2"],
  points:[
   {x:90,y:300},
   {x:170,y:300},
   {x:250,y:260},
   {x:250,y:340}
  ]
 }
];

function instruction(){
 if(step>=levels[level].steps.length)
   return "üéâ Nivel completado!";
 return "Conecta: "+levels[level].steps[step];
}

msg.innerText=instruction();

// temporizador
setInterval(()=>{
 time--;
 document.getElementById("timer").innerText="‚è±Ô∏è "+time;
 if(time<=0) msg.innerText="Tiempo terminado";
},1000);

// click
c.onclick=e=>{
 const pts=levels[level].points;
 pts.forEach((p,i)=>{
  if(Math.hypot(p.x-e.clientX,p.y-e.clientY)<20)
    connect(i);
 });
};

function nextLevel(){
 level++;
 if(level>=levels.length){
   msg.innerText="üèÜ ¬°Curso completado!";
   return;
 }
 step=0;
 lvlTxt.innerText=levels[level].name;
 msg.innerText=instruction();
}

function connect(i){

 if(i===step){
   ok.play();
   score+=10;
   step++;

   if(step>=levels[level].steps.length){
     score+=20;
     setTimeout(nextLevel,1500);
   }
 }
 else{
   bad.play();
   msg.innerText="‚ùå Error, revisa el orden";
   score-=5;
   setTimeout(()=>msg.innerText=instruction(),1500);
 }

 scoreTxt.innerText="‚≠ê "+score;
 msg.innerText=instruction();
}

// DIBUJO
function drawBoard(){
 ctx.fillStyle="#ddd";
 ctx.fillRect(40,240,340,140);
}

function drawPoints(){
 levels[level].points.forEach(p=>{
  ctx.fillStyle="cyan";
  ctx.beginPath();
  ctx.arc(p.x,p.y,8,0,Math.PI*2);
  ctx.fill();
 });
}

function drawLED(x,y,on){
 ctx.fillStyle=on?"lime":"darkred";
 ctx.beginPath();
 ctx.arc(x,y,14,0,Math.PI*2);
 ctx.fill();
}

function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 drawBoard();

 const pts=levels[level].points;

 // cables
 ctx.strokeStyle="lime";
 ctx.lineWidth=4;
 for(let i=0;i<step-1;i++){
  ctx.beginPath();
  ctx.moveTo(pts[i].x,pts[i].y);
  ctx.lineTo(pts[i+1].x,pts[i+1].y);
  ctx.stroke();
 }

 // LEDs nivel 3
 if(level===2){
  drawLED(250,260,step>2);
  drawLED(250,340,step>3);
 }
 else{
  drawLED(270,300,step>=levels[level].steps.length);
 }

 drawPoints();
 requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
