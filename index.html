<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;font-family:Arial;background:black;}

#video{
 position:absolute;width:100%;height:100%;
 object-fit:cover;
}

#canvas{
 position:absolute;top:0;left:0;
}

.ui{
 position:absolute;
 background:rgba(0,0,0,0.6);
 color:white;
 padding:10px 15px;
 border-radius:12px;
}

#msg{top:10px;left:50%;transform:translateX(-50%);}
#score{bottom:10px;left:10px;}
</style>
</head>

<body>

<div id="msg" class="ui">Arrastra la batería al inicio</div>
<div id="score" class="ui">⭐0</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<audio id="ok" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="bad" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

<script>
const v=video;
const c=canvas;
const ctx=c.getContext("2d");

navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
}).then(s=>v.srcObject=s);

function resize(){
 c.width=innerWidth;
 c.height=innerHeight;
}
resize(); onresize=resize;

let score=0;
const msg=document.getElementById("msg");
const scoreTxt=document.getElementById("score");
const ok=document.getElementById("ok");
const bad=document.getElementById("bad");

//////////////////////////////
// SNAP POINTS
//////////////////////////////

const slots=[
 {x:100,y:350,filled:false},
 {x:200,y:350,filled:false},
 {x:300,y:350,filled:false}
];

//////////////////////////////
// COMPONENTES
//////////////////////////////

let comps=[
 {type:"battery",x:80,y:150,w:60,h:30,placed:false},
 {type:"resistor",x:200,y:150,w:60,h:20,placed:false},
 {type:"led",x:320,y:150,w:30,h:30,placed:false}
];

let dragging=null;

//////////////////////////////
// DRAG SYSTEM
//////////////////////////////

c.onmousedown=e=>{
 comps.forEach(comp=>{
  if(e.clientX>comp.x && e.clientX<comp.x+comp.w &&
     e.clientY>comp.y && e.clientY<comp.y+comp.h){
       dragging=comp;
  }
 });
};

c.onmousemove=e=>{
 if(dragging){
   dragging.x=e.clientX-20;
   dragging.y=e.clientY-20;
 }
};

c.onmouseup=e=>{
 if(!dragging) return;

 // SNAP MAGNÉTICO
 slots.forEach((s,i)=>{
  if(!s.filled && Math.hypot(dragging.x-s.x,dragging.y-s.y)<40){

    // ORDEN CORRECTO
    if(
     (i===0 && dragging.type==="battery") ||
     (i===1 && dragging.type==="resistor") ||
     (i===2 && dragging.type==="led")
    ){
      dragging.x=s.x;
      dragging.y=s.y;
      dragging.placed=true;
      s.filled=true;
      ok.play();
      score+=10;
      msg.innerText="✔ Correcto!";
    }
    else{
      bad.play();
      score-=5;
      msg.innerText="❌ Error: orden incorrecto";
      setTimeout(()=>{
       msg.innerText="Sigue el orden: batería → resistencia → LED";
      },1500);
    }
  }
 });

 scoreTxt.innerText="⭐"+score;
 dragging=null;
};

//////////////////////////////
// DIBUJOS REALISTAS
//////////////////////////////

function drawBoard(){
 ctx.fillStyle="#e5e5e5";
 ctx.fillRect(40,320,340,120);
}

function drawSlots(){
 slots.forEach(s=>{
  ctx.fillStyle="rgba(0,200,255,0.3)";
  ctx.beginPath();
  ctx.arc(s.x+20,s.y+20,15,0,Math.PI*2);
  ctx.fill();
 });
}

function battery(x,y){
 ctx.fillStyle="black";
 ctx.fillRect(x,y,50,25);
 ctx.fillStyle="gold";
 ctx.fillRect(x+50,y+8,10,8);
}

function resistor(x,y){
 ctx.fillStyle="#d2a679";
 ctx.fillRect(x,y,40,16);
 ctx.fillStyle="red"; ctx.fillRect(x+6,y,4,16);
 ctx.fillStyle="blue"; ctx.fillRect(x+14,y,4,16);
}

function led(x,y){
 let g=ctx.createRadialGradient(x,y,3,x,y,15);
 g.addColorStop(0,"#7CFF7C");
 g.addColorStop(1,"green");
 ctx.fillStyle=g;
 ctx.beginPath();
 ctx.arc(x+10,y+10,12,0,Math.PI*2);
 ctx.fill();

 ctx.strokeStyle="silver";
 ctx.beginPath();
 ctx.moveTo(x+5,y+20);
 ctx.lineTo(x+5,y+35);
 ctx.moveTo(x+15,y+20);
 ctx.lineTo(x+15,y+35);
 ctx.stroke();
}

//////////////////////////////
// LOOP
//////////////////////////////

function draw(){
 ctx.clearRect(0,0,c.width,c.height);

 drawBoard();
 drawSlots();

 comps.forEach(comp=>{
  if(comp.type==="battery") battery(comp.x,comp.y);
  if(comp.type==="resistor") resistor(comp.x,comp.y);
  if(comp.type==="led") led(comp.x,comp.y);
 });

 requestAnimationFrame(draw);
}
draw();

</script>
</body>
</html>
