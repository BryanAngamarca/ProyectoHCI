<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;overflow:hidden;font-family:Arial;background:#eef2f7;}

#video{
 position:absolute;width:100%;height:100%;
 object-fit:cover;z-index:1;
}

#canvas{
 position:absolute;top:0;left:0;z-index:2;
}

.ui{
 position:absolute;
 background:rgba(0,60,120,0.75);
 color:white;
 padding:12px 18px;
 border-radius:14px;
 z-index:3;
 font-size:18px;
}

#msg{top:10px;left:50%;transform:translateX(-50%);}
#score{bottom:10px;left:10px;}
#timer{bottom:10px;right:10px;}
</style>
</head>

<body>

<div id="msg" class="ui">üìò Conecta la energ√≠a (1)</div>
<div id="score" class="ui">‚≠ê Puntaje: 0</div>
<div id="timer" class="ui">‚è±Ô∏è Tiempo: 60</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<!-- sonidos -->
<audio id="okSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="badSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

<script>
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const msg=document.getElementById("msg");
const scoreTxt=document.getElementById("score");
const timerTxt=document.getElementById("timer");

const okSound=document.getElementById("okSound");
const badSound=document.getElementById("badSound");

// c√°mara trasera
navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
}).then(s=>video.srcObject=s);

// tama√±o
function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
onresize=resize;

// juego
let step=0;
let score=0;
let time=60;
let gameOver=false;

// temporizador
setInterval(()=>{
 if(gameOver) return;
 time--;
 timerTxt.innerText="‚è±Ô∏è Tiempo: "+time;
 if(time<=0){
   msg.innerText="‚è∞ Tiempo terminado. Intenta otra vez!";
   gameOver=true;
 }
},1000);

// puntos
const points=[
 {x:90,y:300},
 {x:180,y:300},
 {x:270,y:300}
];

canvas.addEventListener("click",(e)=>{
 if(gameOver) return;
 const x=e.clientX;
 const y=e.clientY;

 points.forEach((p,i)=>{
  if(Math.hypot(p.x-x,p.y-y)<20){
    connect(i);
  }
 });
});

function connect(i){

 if(step===0 && i===0){
   okSound.play();
   msg.innerText="üëè Bien! Ahora la resistencia";
   score+=10;
   step=1;
 }

 else if(step===1 && i===1){
   okSound.play();
   msg.innerText="üëç Excelente! Conecta el LED";
   score+=10;
   step=2;
 }

 else if(step===2 && i===2){
   okSound.play();
   msg.innerText="üéâ ¬°Perfecto! Circuito completo";
   score+=20;
   step=3;
   gameOver=true;
 }

 else{
   badSound.play();
   msg.innerText="‚ùå Ups! Intenta el orden correcto";
   score-=5;
 }

 scoreTxt.innerText="‚≠ê Puntaje: "+score;
}

// dibujos
function protoboard(){
 ctx.fillStyle="#dcdcdc";
 ctx.fillRect(40,240,320,140);

 for(let i=0;i<10;i++){
  for(let j=0;j<4;j++){
   ctx.fillStyle="#888";
   ctx.beginPath();
   ctx.arc(60+i*30,260+j*30,4,0,Math.PI*2);
   ctx.fill();
  }
 }
}

function resistor(){
 ctx.fillStyle="#c69c6d";
 ctx.fillRect(165,290,40,18);
}

function led(){
 ctx.fillStyle=(step===3)?"lime":"darkred";
 ctx.beginPath();
 ctx.arc(270,300,14,0,Math.PI*2);
 ctx.fill();
}

function wires(){
 ctx.strokeStyle="lime";
 ctx.lineWidth=4;

 if(step>0){
  ctx.beginPath();
  ctx.moveTo(90,300);
  ctx.lineTo(180,300);
  ctx.stroke();
 }

 if(step>1){
  ctx.beginPath();
  ctx.moveTo(180,300);
  ctx.lineTo(270,300);
  ctx.stroke();
 }
}

function pointsDraw(){
 points.forEach((p,i)=>{
   ctx.fillStyle="cyan";
   ctx.beginPath();
   ctx.arc(p.x,p.y,8,0,Math.PI*2);
   ctx.fill();
 });
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 protoboard();
 resistor();
 led();
 wires();
 pointsDraw();

 requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
