<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;font-family:Arial;}

#video{
 position:absolute;width:100%;height:100%;
 object-fit:cover;z-index:1;
}

#canvas{
 position:absolute;top:0;left:0;z-index:2;
}

.ui{
 position:absolute;
 background:rgba(0,0,0,0.6);
 color:white;
 padding:10px 15px;
 border-radius:12px;
 z-index:3;
}

#msg{top:10px;left:50%;transform:translateX(-50%);}
#score{bottom:10px;left:10px;}
#info{bottom:10px;right:10px;font-size:14px;}
</style>
</head>

<body>

<div id="msg" class="ui">Arrastra bater√≠a ‚Üí resistencia ‚Üí LED</div>
<div id="score" class="ui">‚≠ê0</div>
<div id="info" class="ui">üí° La resistencia protege al LED</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<audio id="ok" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="bad" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

<script>
const v=video;
const c=canvas;
const ctx=c.getContext("2d");

navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
}).then(s=>v.srcObject=s);

function resize(){
 c.width=innerWidth;
 c.height=innerHeight;
}
resize(); onresize=resize;

const msg=document.getElementById("msg");
const scoreTxt=document.getElementById("score");
const info=document.getElementById("info");

let score=0;
let step=0;

const ok=document.getElementById("ok");
const bad=document.getElementById("bad");

//////////////////////
// SNAP POINTS
//////////////////////

const slots=[
 {x:90,y:350,filled:false},
 {x:190,y:350,filled:false},
 {x:290,y:350,filled:false}
];

//////////////////////
// COMPONENTES
//////////////////////

let comps=[
 {type:"battery",x:80,y:150,w:60,h:30},
 {type:"resistor",x:200,y:150,w:60,h:20},
 {type:"led",x:320,y:150,w:30,h:30}
];

let dragging=null;

//////////////////////
// TOUCH SUPPORT
//////////////////////

function getPos(e){
 if(e.touches) return {
  x:e.touches[0].clientX,
  y:e.touches[0].clientY
 };
 return {x:e.clientX,y:e.clientY};
}

c.addEventListener("touchstart",start);
c.addEventListener("touchmove",move);
c.addEventListener("touchend",end);

c.addEventListener("mousedown",start);
c.addEventListener("mousemove",move);
c.addEventListener("mouseup",end);

function start(e){
 let p=getPos(e);
 comps.forEach(comp=>{
  if(p.x>comp.x && p.x<comp.x+comp.w &&
     p.y>comp.y && p.y<comp.y+comp.h){
       dragging=comp;
  }
 });
}

function move(e){
 if(!dragging) return;
 let p=getPos(e);
 dragging.x=p.x-20;
 dragging.y=p.y-20;
}

function end(e){
 if(!dragging) return;

 slots.forEach((s,i)=>{
  if(Math.hypot(dragging.x-s.x,dragging.y-s.y)<40){

   if(
    (step===0 && dragging.type==="battery") ||
    (step===1 && dragging.type==="resistor") ||
    (step===2 && dragging.type==="led")
   ){
     dragging.x=s.x;
     dragging.y=s.y;
     ok.play();

     score+=10;
     step++;

     msg.innerText="‚úî Bien hecho";
     info.innerText="üëç Conexi√≥n correcta";

     if(step===3){
       msg.innerText="üéâ ¬°Circuito completo!";
       info.innerText="El LED enciende porque hay corriente controlada";
     }
   }
   else{
     bad.play();
     score-=5;
     msg.innerText="‚ùå Error";
     info.innerText="‚ö†Ô∏è Sin resistencia el LED puede da√±arse";

     setTimeout(()=>{
      msg.innerText="Orden: bater√≠a ‚Üí resistencia ‚Üí LED";
     },1500);
   }

   scoreTxt.innerText="‚≠ê"+score;
  }
 });

 dragging=null;
}

//////////////////////
// DIBUJOS
//////////////////////

function board(){
 ctx.fillStyle="#e5e5e5";
 ctx.fillRect(40,320,340,120);
}

function battery(x,y){
 ctx.fillStyle="black";
 ctx.fillRect(x,y,50,25);
 ctx.fillStyle="gold";
 ctx.fillRect(x+50,y+8,10,8);
}

function resistor(x,y){
 ctx.fillStyle="#d2a679";
 ctx.fillRect(x,y,40,16);
 ctx.fillStyle="red"; ctx.fillRect(x+6,y,4,16);
 ctx.fillStyle="blue"; ctx.fillRect(x+14,y,4,16);
}

function led(x,y){
 let g=ctx.createRadialGradient(x,y,3,x,y,15);
 g.addColorStop(0,"#7CFF7C");
 g.addColorStop(1,"green");
 ctx.fillStyle=g;
 ctx.beginPath();
 ctx.arc(x+10,y+10,12,0,Math.PI*2);
 ctx.fill();

 ctx.strokeStyle="silver";
 ctx.beginPath();
 ctx.moveTo(x+5,y+20);
 ctx.lineTo(x+5,y+35);
 ctx.moveTo(x+15,y+20);
 ctx.lineTo(x+15,y+35);
 ctx.stroke();
}

function slotsDraw(){
 slots.forEach(s=>{
  ctx.fillStyle="rgba(0,255,255,0.25)";
  ctx.beginPath();
  ctx.arc(s.x+20,s.y+20,14,0,Math.PI*2);
  ctx.fill();
 });
}

function draw(){
 ctx.clearRect(0,0,c.width,c.height);

 board();
 slotsDraw();

 comps.forEach(cmp=>{
  if(cmp.type==="battery") battery(cmp.x,cmp.y);
  if(cmp.type==="resistor") resistor(cmp.x,cmp.y);
  if(cmp.type==="led") led(cmp.x,cmp.y);
 });

 requestAnimationFrame(draw);
}
draw();

</script>
</body>
</html>
