<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;overflow:hidden;font-family:Arial;}

#video{
 position:absolute;width:100%;height:100%;
 object-fit:cover;z-index:1;
}

#canvas{
 position:absolute;top:0;left:0;z-index:2;
}

.ui{
 position:absolute;
 background:rgba(0,60,120,0.75);
 color:white;
 padding:12px 16px;
 border-radius:12px;
 z-index:3;
 font-size:16px;
}

#msg{top:10px;left:50%;transform:translateX(-50%);}
#score{bottom:10px;left:10px;}
#timer{bottom:10px;right:10px;}

#info{
 top:70px;
 left:10px;
 max-width:220px;
 background:rgba(0,0,0,0.6);
 font-size:14px;
}
</style>
</head>

<body>

<div id="msg" class="ui">Conecta la energ√≠a (1)</div>
<div id="score" class="ui">‚≠ê 0</div>
<div id="timer" class="ui">‚è±Ô∏è 60</div>

<div id="info" class="ui">
üìò COMPONENTES<br>
Resistencia: limita corriente.<br>
LED: emite luz.<br><br>
‚ö†Ô∏è Error de conexi√≥n:<br>
Sin resistencia ‚Üí LED puede da√±arse.
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<audio id="okSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="badSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

<script>
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const msg=document.getElementById("msg");
const scoreTxt=document.getElementById("score");
const timerTxt=document.getElementById("timer");

const okSound=document.getElementById("okSound");
const badSound=document.getElementById("badSound");

// c√°mara trasera
navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
}).then(s=>video.srcObject=s);

// tama√±o
function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
onresize=resize;

// estado
let step=0;
let score=0;
let time=60;
let gameOver=false;

function instruction(){
 if(step===0) return "Conecta la energ√≠a (1)";
 if(step===1) return "Conecta la resistencia (2)";
 if(step===2) return "Conecta el LED (3)";
 if(step===3) return "üéâ Circuito completo!";
}

// temporizador
setInterval(()=>{
 if(gameOver) return;
 time--;
 timerTxt.innerText="‚è±Ô∏è "+time;
 if(time<=0){
  msg.innerText="Tiempo terminado";
  gameOver=true;
 }
},1000);

// puntos
const points=[
 {x:90,y:300},
 {x:180,y:300},
 {x:270,y:300}
];

canvas.addEventListener("click",(e)=>{
 if(gameOver) return;
 const x=e.clientX;
 const y=e.clientY;

 points.forEach((p,i)=>{
  if(Math.hypot(p.x-x,p.y-y)<20){
    connect(i);
  }
 });
});

function connect(i){

 if(step===0 && i===0){
  okSound.play();
  score+=10;
  step=1;
 }

 else if(step===1 && i===1){
  okSound.play();
  score+=10;
  step=2;
 }

 else if(step===2 && i===2){
  okSound.play();
  score+=20;
  step=3;
  gameOver=true;
 }

 else{
  badSound.play();
  msg.innerText="‚ùå Error: orden incorrecto";
  score-=5;

  // volver a instrucci√≥n despu√©s de 2s
  setTimeout(()=>{
   msg.innerText=instruction();
  },2000);
 }

 scoreTxt.innerText="‚≠ê "+score;

 if(step<=3)
  msg.innerText=instruction();
}

// dibujos
function protoboard(){
 ctx.fillStyle="#dcdcdc";
 ctx.fillRect(40,240,320,140);
}

function resistor(){
 ctx.fillStyle="#c69c6d";
 ctx.fillRect(165,290,40,18);
}

function led(){
 ctx.fillStyle=(step===3)?"lime":"darkred";
 ctx.beginPath();
 ctx.arc(270,300,14,0,Math.PI*2);
 ctx.fill();
}

function wires(){
 ctx.strokeStyle="lime";
 ctx.lineWidth=4;

 if(step>0){
  ctx.beginPath();
  ctx.moveTo(90,300);
  ctx.lineTo(180,300);
  ctx.stroke();
 }

 if(step>1){
  ctx.beginPath();
  ctx.moveTo(180,300);
  ctx.lineTo(270,300);
  ctx.stroke();
 }
}

function pointsDraw(){
 points.forEach(p=>{
  ctx.fillStyle="cyan";
  ctx.beginPath();
  ctx.arc(p.x,p.y,8,0,Math.PI*2);
  ctx.fill();
 });
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 protoboard();
 resistor();
 led();
 wires();
 pointsDraw();

 requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
